<!--
  ~ Copyright 2018 the original author or authors.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width"/>
    <base href="/"/>
    <!--<link rel="stylesheet" type="text/css" href="/webjars/bootstrap/css/bootstrap.min.css"/>-->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <!--<script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"></script>-->
    <style>
        p {
            margin: 0;
            color: blue;
        }
        div {
            float:left;
        }
        div,p {
            margin-left: 20px;
        }
        span {
            color: red;
        }
        .not_found {
            color: red;

        }
         .btn {
             background-color: DarkGrey;
             border: none;
             color: white;
             padding: 5px 5px;
             font-size: 10px;
             cursor: pointer;
         }

        /* Darker background on mouse-over */
        .btn:hover {
            background-color: Red;
        }
    </style>
    <title>IReal Pro Set List Importer</title>
    <script>


        $(document).ready(
            //     function() {
            //     alert('ready')
            //     $.ajax({
            //         url: '/songs?title=Song',
            //         type: "GET",
            //         dataType: "json",
            //         success: function (data) {
            //             console.log(data);
            //             alert(data);
            //         },
            //         fail: function () {
            //             alert('fail');
            //             console.log("Encountered an error")
            //         }
            //     });
            // }
        );
    </script>
</head>
<body>
<h1>IReal Pro Set List Importer</h1>
<div class="search">
    <form id="form_setlist">
        <p>Paste set list here</p>
        <div>
            <textarea id="ta_setlist" rows="20" cols="50"></textarea>
        </div>
        <div>
            <input type="submit" value="Search">
        </div>
    </form>
</div>
<div class="results">
    <form id="import">
    <div id="results_div"></div>
    <div id="import_button_div"></div>
    </form>
</div>

<script>
    $("#form_setlist").submit(function (event) {
        $.ajax({
            url: '/setlist/prepare',
            type: "POST",
            data: $("#ta_setlist").val(),
            contentType: 'text/plain',
            success: function (data) {
                console.log(data);
                $('#results_div').empty();
                $('#import_button_div').empty();
                var table = $('<table id="import_table">').addClass('result_table');
                $.each(data, function(i, value) {
                    var row = $('<tr>').addClass('result_entry')
                        .append($('<td>').text(value.title))
                        .append($('<td>').text(value.candidates == null ? 'Not found' : value.candidates[0].title));

                    if (value.candidates == null) {
                        row.addClass("not_found");
                    } else {
                        row.append($('<td>').append(
                            $('<button id="' + value.selectedUniqueId + '">').addClass('btn')
                                .click(function(){
                                    $(this).closest ('tr').remove ();

                                })
                                .append($('<i>').addClass('fa fa-close'))));
                    }

                    table.append(row);
                });

                $('#results_div').append(table);
                $('#import_button_div').append($('<input type="submit" value="Import">'));
            },
            fail: function () {
                alert('Search encountered an error');
                console.log("Search encountered an error")
            }
        });
        event.preventDefault();
    });

    $("#import").submit(function(event) {

        alert("! -> ");
        $(".btn").each(function() {
            console.log($(this)[0].id);
        });

        event.preventDefault();
    })
</script>

</body>
</html>
